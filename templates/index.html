<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>YTD ‚Äî Modern Video Downloader</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="background-stripes" aria-hidden="true"></div>

    <div id="water-rays-wrap" aria-hidden="true">
      <canvas id="water-rays"></canvas>
    </div>

    <div id="background-glow" aria-hidden="true" class="animate"></div>

    <canvas id="particles" aria-hidden="true"></canvas>

    <div class="container" role="main" aria-live="polite">
        <header>
            <h1 id="app-title" title="YTD">YTD ‚Äî Modern Video Downloader</h1>
            <p>–°–∫–∞—á–∞–π—Ç–µ –≤–∏–¥–µ–æ –∏–ª–∏ –∞—É–¥–∏–æ —Å YouTube –∏ –¥—Ä—É–≥–∏—Ö —Å–∞–π—Ç–æ–≤</p>
        </header>

        <div class="input-section">
            <input type="text" id="url" placeholder="https://youtu.be/..." aria-label="URL –≤–∏–¥–µ–æ" />
            <button id="fetch-btn" class="btn-primary">–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</button>
        </div>

        <div id="preview" class="preview hidden" aria-hidden="true">
            <img id="preview-image" src="" alt="–ü—Ä–µ–≤—å—é" />
            <div class="preview-info">
                <h3 id="preview-title" class="ellipsis" title="">–ó–∞–≥—Ä—É–∑–∫–∞...</h3>
                <p id="preview-duration">‚Äî</p>
            </div>
        </div>

        <div class="filters hidden" id="filters">
            <select id="filter-type" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É" style="display:none;">
                <option value="all">–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã</option>
                <option value="audio">–¢–æ–ª—å–∫–æ –∞—É–¥–∏–æ</option>
                <option value="video">–¢–æ–ª—å–∫–æ –≤–∏–¥–µ–æ</option>
            </select>

            <div id="custom-filter" class="custom-select" role="listbox" tabindex="0" aria-label="–§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É">
                <div class="custom-select__current" id="custom-filter-current" aria-hidden="true">–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã ‚ñæ</div>
                <div class="custom-select__list hidden" id="custom-filter-list" role="menu" aria-hidden="true">
                    <div class="option-item" role="option" data-value="all">–í—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã</div>
                    <div class="option-item" role="option" data-value="audio">–¢–æ–ª—å–∫–æ –∞—É–¥–∏–æ</div>
                    <div class="option-item" role="option" data-value="video">–¢–æ–ª—å–∫–æ –≤–∏–¥–µ–æ</div>
                </div>
            </div>

            <div id="sort-buttons" class="sort-buttons" role="toolbar" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞">
                <button class="sort-button active" data-sort="default" title="–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</button>
                <button class="sort-button" data-sort="size-desc" title="–ü–æ —Ä–∞–∑–º–µ—Ä—É (—É–±—ã–≤.)">–ü–æ —Ä–∞–∑–º–µ—Ä—É</button>
                <button class="sort-button" data-sort="quality" title="–ü–æ –∫–∞—á–µ—Å—Ç–≤—É">–ü–æ –∫–∞—á–µ—Å—Ç–≤—É</button>
                <button class="sort-button" data-sort="format" title="–ü–æ —Ñ–æ—Ä–º–∞—Ç—É">–ü–æ —Ñ–æ—Ä–º–∞—Ç—É</button>
            </div>
        </div>

        <div id="formats" class="formats hidden" aria-live="polite">
            <h3>üìÅ –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã:</h3>
            <div id="formats-list" class="formats-grid"></div>
        </div>

        <div id="progress" class="card hidden" aria-hidden="true">
            <div class="spinner" role="status" aria-hidden="true"></div>
            <p id="status-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</p>
        </div>

        <div id="error" class="card error hidden" role="alert"></div>
    </div>

<script>
/* particles (—Ñ–æ–Ω) - —Ç–æ—á–∫–∏ */
const pcanvas = document.getElementById('particles');
const pctx = pcanvas.getContext('2d');
function resizeParticles(){ pcanvas.width = window.innerWidth; pcanvas.height = window.innerHeight; }
resizeParticles(); window.addEventListener('resize', ()=>{ resizeParticles(); resizeRays(); });
const particles = [], pcount = 60;
class P{ constructor(){ this.x=Math.random()*pcanvas.width; this.y=Math.random()*pcanvas.height; this.s=Math.random()*2+0.5; this.vx=(Math.random()*0.6-0.3); this.vy=(Math.random()*0.6-0.3); this.c=`rgba(120,130,255,${Math.random()*0.24+0.06})`; } update(){ this.x+=this.vx; this.y+=this.vy; if(this.x<0||this.x>pcanvas.width) this.vx*=-1; if(this.y<0||this.y>pcanvas.height) this.vy*=-1 } draw(){ pctx.fillStyle=this.c; pctx.beginPath(); pctx.arc(this.x,this.y,this.s,0,Math.PI*2); pctx.fill(); } }
for(let i=0;i<pcount;i++) particles.push(new P());
(function panim(){ pctx.clearRect(0,0,pcanvas.width,pcanvas.height); pctx.fillStyle='rgba(0,0,0,0.02)'; pctx.fillRect(0,0,pcanvas.width,pcanvas.height); for(const p of particles){ p.update(); p.draw(); } requestAnimationFrame(panim); })();

/* water rays (canvas) - –ø–æ–¥–≤–æ–¥–Ω–æ–µ –ø–µ—Ä–µ–ª–∏–≤–∞–Ω–∏–µ */
const raysCanvas = document.getElementById('water-rays');
const rctx = raysCanvas.getContext('2d');
let raysW=0, raysH=0;
function resizeRays(){ raysCanvas.width = raysW = window.innerWidth; raysCanvas.height = raysH = Math.max(window.innerHeight * 0.36, 220); }
resizeRays();

let t0 = 0;
function drawRays(ts){
    t0 = ts/1000;
    rctx.clearRect(0,0,raysW,raysH);

    const g = rctx.createLinearGradient(0,0,0,raysH);
    g.addColorStop(0, 'rgba(12,12,20,0.85)');
    g.addColorStop(0.6, 'rgba(12,12,20,0.0)');
    rctx.fillStyle = g;
    rctx.fillRect(0,0,raysW,raysH);

    rctx.globalCompositeOperation = 'lighter';
    for(let layer=0; layer<3; layer++){
        const hue = 230 + layer*8;
        const alpha = 0.035 + layer*0.02;
        rctx.fillStyle = `rgba(${hue}, ${hue}, 255, ${alpha})`;
        rctx.beginPath();
        const amp = 18 + layer*12;
        const freq = 0.0022 + layer*0.0012;
        const speed = 0.8 + layer*0.4;
        rctx.moveTo(0, raysH);
        for(let x=0;x<=raysW;x+=8){
            const y = raysH*0.6 + Math.sin((x*freq) + t0*speed + layer)*amp*(1+Math.sin(x*0.001+layer));
            rctx.lineTo(x, y);
        }
        rctx.lineTo(raysW, raysH);
        rctx.closePath();
        rctx.fill();
    }
    rctx.globalCompositeOperation = 'source-over';

    rctx.globalAlpha = 0.06;
    for(let i=0;i<60;i++){
        const x = Math.random()*raysW;
        const y = Math.random()*raysH;
        const s = Math.random()*3;
        rctx.fillStyle = `rgba(200,200,255,0.06)`;
        rctx.fillRect(x,y,s,s);
    }
    rctx.globalAlpha = 1.0;

    requestAnimationFrame(drawRays);
}
requestAnimationFrame(drawRays);

/* –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è */
const baseUrl = window.location.origin;
let currentFormats = [], videoTitle = "video", sortMode = "default";

function showElement(id){ document.getElementById(id).classList.remove('hidden'); }
function hideElement(id){ document.getElementById(id).classList.add('hidden'); }
function showError(msg){ const el = document.getElementById('error'); el.textContent = msg; showElement('error'); setTimeout(()=>hideElement('error'),6000); }
function showProgress(text){ document.getElementById('status-text').textContent = text; showElement('progress'); }
function hideProgress(){ hideElement('progress'); }

function parseRes(res){ if(!res||res==='‚Äî'||res==='–ê—É–¥–∏–æ') return 0; const m = res.match(/(\d+)[x√ó](\d+)/); return m?parseInt(m[2]):0; }
function humanSize(bytes){ if(!bytes) return '‚Äî'; const units=['–±','–ö–ë','–ú–ë','–ì–ë']; let i=0, val=bytes; while(val>1024&&i<units.length-1){ val/=1024; i++ } return val.toFixed(1)+' '+units[i]; }

function applyFilters(){
    const type = document.getElementById('filter-type').value;
    let filtered = [...currentFormats];

    if(type === 'audio') filtered = filtered.filter(f => f.acodec !== 'none' && f.vcodec === 'none');
    else if(type === 'video') filtered = filtered.filter(f => f.vcodec !== 'none');

    if(sortMode === 'size-asc') filtered.sort((a,b)=>(a.filesize||0)-(b.filesize||0));
    else if(sortMode === 'size-desc') filtered.sort((a,b)=>(b.filesize||0)-(a.filesize||0));
    else if(sortMode === 'quality'){
        filtered.sort((a,b)=>{
            const aAudio = a.acodec!=='none' && a.vcodec==='none';
            const bAudio = b.acodec!=='none' && b.vcodec==='none';
            if(aAudio && !bAudio) return -1;
            if(!aAudio && bAudio) return 1;
            if(aAudio) return (b.tbr||0)-(a.tbr||0);
            return parseRes(b.resolution)-parseRes(a.resolution);
        });
    } else if(sortMode === 'format') filtered.sort((a,b)=> (a.ext||'').localeCompare(b.ext||''));
    renderFormats(filtered);
}

/* –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ (—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏) */
document.querySelectorAll('.sort-button').forEach(btn=>{
    btn.addEventListener('click', ()=>{
        document.querySelectorAll('.sort-button').forEach(x=>x.classList.remove('active'));
        btn.classList.add('active');
        sortMode = btn.dataset.sort;
        applyFilters();
    });
});

/* –∫–∞—Å—Ç–æ–º–Ω—ã–π —Å–µ–ª–µ–∫—Ç (—Ñ–∏–ª—å—Ç—Ä) ‚Äî —É–ª—É—á—à–µ–Ω–æ: –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ */
(function setupCustomSelect(){
    const real = document.getElementById('filter-type');
    const selectWrap = document.getElementById('custom-filter');
    const current = document.getElementById('custom-filter-current');
    const list = document.getElementById('custom-filter-list');
    const items = list.querySelectorAll('.option-item');

    function setValue(val,text){
        real.value = val;
        current.textContent = text + ' ‚ñæ';
        applyFilters();
    }

    items.forEach(it=>{
        it.addEventListener('click', (e)=>{
            e.stopPropagation();
            setValue(it.dataset.value, it.textContent);
            list.classList.add('hidden');
        });
    });

    selectWrap.addEventListener('click', (e)=>{
        e.stopPropagation();
        list.classList.toggle('hidden');
    });

    // close on outside click
    document.addEventListener('click', (e)=>{
        if(!selectWrap.contains(e.target)) list.classList.add('hidden');
    });

    // keyboard support
    selectWrap.addEventListener('keydown', (e)=>{
        if(e.key === 'Enter' || e.key === ' ') {
            list.classList.toggle('hidden'); e.preventDefault();
        } else if(e.key === 'Escape') {
            list.classList.add('hidden');
        }
    });
})();

function friendlyCodec(codec) {
    if (!codec || codec === 'none') return null;
    codec = codec.toLowerCase();
    if (codec.startsWith('mp4a')) return 'aac';
    if (codec.includes('opus')) return 'opus';
    if (codec.includes('vorbis')) return 'vorbis';
    if (codec.includes('mp3')) return 'mp3';
    if (codec.includes('vp9')) return 'vp9';
    if (codec.includes('av01')) return 'av1';
    if (codec.includes('h264') || codec.includes('avc')) return 'h264';
    return codec;
}

/* —Ä–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç–æ—á–µ–∫ —Ñ–æ—Ä–º–∞—Ç–æ–≤: –¥–æ–±–∞–≤–ª–µ–Ω–∞ audio-toggle (–ø—Ä–∞–≤—ã–π –≤–µ—Ä—Ö),
   –∏ download-link –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è ‚Äî —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ */
function renderFormats(formats){
    const container = document.getElementById('formats-list');
    container.innerHTML = '';
    if(!formats.length){ container.innerHTML = '<div class="format-card">–§–æ—Ä–º–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>'; return; }

    formats.forEach((f)=>{
        const isAudio = f.acodec!=='none' && f.vcodec==='none';
        const ext = (f.ext||'').toUpperCase();
        const size = humanSize(f.filesize);
        const resolution = f.resolution && f.resolution!=='‚Äî' ? f.resolution : null;

        const meta = [ ext, resolution ? resolution : null, isAudio ? '–ê—É–¥–∏–æ' : '–í–∏–¥–µ–æ' ].filter(Boolean).join(' ¬∑ ');

        const card = document.createElement('div');
        card.className = 'format-card';
        card.dataset.includeAudio = 'false';
        card.innerHTML = `
            <div class="format-badge ${isAudio ? 'badge-audio' : 'badge-video'}">${isAudio ? 'AUDIO' : 'VIDEO'}</div>

            <button class="audio-toggle" title="–í–∫–ª—é—á–∏—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∞—É–¥–∏–æ –ø—Ä–∏ —Å–∫–∞—á–∏–≤–∞–Ω–∏–∏" aria-pressed="false" type="button">
                <svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor" aria-hidden="true">
                  <path d="M5 9v6h4l5 4V5L9 9H5z"></path>
                </svg>
            </button>

            <div class="format-info">
                <div class="format-meta small">${meta}</div>
                <div class="format-size small">${size}</div>
            </div>

            <div class="format-actions">
                <button class="btn-download">–°–∫–∞—á–∞—Ç—å</button>
            </div>

            <div class="download-status hidden">
                <div class="spinner-small" aria-hidden="true"></div>
                <span class="status-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</span>
                <div class="download-area" style="display:inline-flex;align-items:center;gap:8px;"></div>
            </div>
        `;

        container.appendChild(card);

        // audio toggle logic
            const toggle = card.querySelector('.audio-toggle');
            toggle.addEventListener('click', (e)=>{
                e.stopPropagation();
                const active = toggle.classList.toggle('on');
                toggle.classList.remove('failed');
                toggle.setAttribute('aria-pressed', active ? 'true' : 'false');
                card.dataset.includeAudio = active ? 'true' : 'false';
            });


        // download button
        const btn = card.querySelector('.btn-download');
        btn.addEventListener('click', ()=>{
            startDownloadForCard(card, f.format_id);
        });
    });

    container.scrollTo({ top: container.scrollHeight, behavior: 'smooth' });
}

/* start download: include_audio sent based on card.dataset.includeAudio.
   Do NOT create visible download link ‚Äî when ready, auto-trigger browser download. */
async function startDownloadForCard(card, formatId){
    const statusEl = card.querySelector('.download-status');
    const statusText = card.querySelector('.status-text');
    const btn = card.querySelector('.btn-download');
    const toggle = card.querySelector('.audio-toggle');
    statusEl.classList.remove('hidden');
    btn.disabled = true;
    statusText.textContent = "–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è...";

    const includeAudio = card.dataset.includeAudio === 'true';
    if(includeAudio){
        toggle.classList.add('on');
        toggle.classList.add('processing');
    } else {
        toggle.classList.remove('processing');
        toggle.classList.remove('failed');
        toggle.classList.remove('on');
        toggle.setAttribute('aria-pressed', 'false');
    }

    try {
        const url = document.getElementById('url').value.trim();
        const body = `url=${encodeURIComponent(url)}&format_id=${encodeURIComponent(formatId)}&title=${encodeURIComponent(videoTitle)}&include_audio=${includeAudio}`;
        const res = await fetch(`${baseUrl}/start`, {
            method:'POST',
            headers:{'Content-Type':'application/x-www-form-urlencoded'},
            body
        });
        const data = await res.json();
        if(data.error){
            showError(data.error);
            statusText.textContent='–û—à–∏–±–∫–∞';
            setTimeout(()=>{ statusEl.classList.add('hidden'); btn.disabled=false; toggle.classList.remove('processing'); },2500);
            return;
        }
        pollStatusForCard(data.task_id, card);
    } catch(e){
        showError("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–¥–∞–Ω–∏—è");
        statusText.textContent='–°–µ—Ç—å';
        setTimeout(()=>{ statusEl.classList.add('hidden'); btn.disabled=false; toggle.classList.remove('processing'); },2500);
    }
}

/* poll status and auto-download when ready (no visible link). */
function pollStatusForCard(taskId, card){
    const statusText = card.querySelector('.status-text');
    const toggle = card.querySelector('.audio-toggle');
    const btn = card.querySelector('.btn-download');

    const interval = setInterval(async ()=>{
        try {
            const res = await fetch(`${baseUrl}/status/${taskId}`);
            const task = await res.json();
            if(task.message) statusText.textContent = Array.isArray(task.message) ? task.message.join(' ') : task.message;

            const audioState = task.audio_state || 'none';

            if(audioState === 'pending'){
                toggle.classList.add('processing');
                toggle.classList.remove('failed');
                toggle.classList.add('on');
            } else if(audioState === 'ok'){
                toggle.classList.remove('processing');
                toggle.classList.remove('failed');
                toggle.classList.add('on');
                toggle.setAttribute('aria-pressed','true');
            } else if(audioState === 'failed'){
                toggle.classList.remove('processing');
                toggle.classList.remove('on');
                toggle.classList.add('failed');
                toggle.setAttribute('aria-pressed','false');
            } else {
                toggle.classList.remove('processing');
            }

            if(task.status === 'done' || task.status === 'partial'){
                clearInterval(interval);
                const sp = card.querySelector('.spinner-small'); if(sp) sp.style.display='none';
                // small UX: show brief status then trigger download
                statusText.textContent = "–ì–æ—Ç–æ–≤–æ ‚Äî –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É...";
                if(task.file_path){
                    const fileName = task.file_path;
                    // auto-download: create hidden link, click it, remove it
                    const href = `${baseUrl}/download-file/${encodeURIComponent(fileName)}`;
                    const a = document.createElement('a');
                    a.href = href;
                    a.download = fileName;
                    a.style.display = 'none';
                    // for some browsers set rel and target
                    a.rel = 'noopener';
                    document.body.appendChild(a);

                    // small delay to let the UI update (0-300ms)
                    setTimeout(()=> {
                        try {
                            a.click();
                            statusText.textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–ø—É—â–µ–Ω–∞";
                        } catch(e) {
                            // fallback: reveal manual link if auto-click blocked
                            showError("–ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ ‚Äî –ø–æ—è–≤–∏—Ç—Å—è —Å—Å—ã–ª–∫–∞ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.");
                            const downloadArea = card.querySelector('.download-area');
                            downloadArea.innerHTML = '';
                            const link = document.createElement('a');
                            link.href = href;
                            link.className = 'download-link';
                            link.textContent = '–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª';
                            link.setAttribute('download', fileName);
                            link.rel = 'noopener';
                            downloadArea.appendChild(link);
                        } finally {
                            try { document.body.removeChild(a); } catch(e){}
                            btn.disabled = false;
                            // hide status after short time
                            setTimeout(()=> {
                                const statusEl = card.querySelector('.download-status');
                                if(statusEl) statusEl.classList.add('hidden');
                            }, 1800);
                        }
                    }, 160);
                } else {
                    btn.disabled = false;
                    setTimeout(()=> {
                        const statusEl = card.querySelector('.download-status');
                        if(statusEl) statusEl.classList.add('hidden');
                    }, 1200);
                }
            } else if(task.status === 'failed'){
                clearInterval(interval);
                statusText.textContent='–û—à–∏–±–∫–∞';
                toggle.classList.remove('processing');
                toggle.classList.add('failed');
                setTimeout(()=>{ card.querySelector('.download-status').classList.add('hidden'); btn.disabled=false; },2500);
            }
        } catch(e){
            clearInterval(interval);
            // network error ‚Äî leave UI stable
            btn.disabled = false;
            toggle.classList.remove('processing');
        }
    }, 2000);
}

/* –∫–Ω–æ–ø–∫–∞ "–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é" */
document.getElementById('fetch-btn').addEventListener('click', async ()=>{
    const url = document.getElementById('url').value.trim();
    if(!url) return showError("–í–≤–µ–¥–∏—Ç–µ URL");
    showProgress("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...");
    hideElement('preview'); hideElement('formats'); hideElement('filters'); hideElement('error');

    try {
        const res = await fetch(`${baseUrl}/info`, {
            method:'POST',
            headers:{'Content-Type':'application/x-www-form-urlencoded'},
            body:`url=${encodeURIComponent(url)}`
        });
        const data = await res.json();
        if(data.error){ showError(data.error); hideProgress(); return; }

        videoTitle = data.title || "video";
        const pt = document.getElementById('preview-title');
        pt.textContent = data.title || '‚Äî';
        pt.title = data.title || '';
        document.getElementById('preview-image').src = data.thumbnail || 'https://via.placeholder.com/640x360?text=No+Preview';
        document.getElementById('preview-duration').textContent = data.duration || '‚Äî';
        showElement('preview');

        currentFormats = (data.formats || []).filter(f => !(f.format_id||'').includes('-drc'));
        applyFilters();
        showElement('filters'); showElement('formats'); hideProgress();
    } catch(e){
        showError("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏");
        hideProgress();
    }
});

/* —Å–∫—Ä—ã—Ç—ã–π select —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è */
document.getElementById('filter-type').addEventListener('change', applyFilters);
</script>

</body>
</html>
